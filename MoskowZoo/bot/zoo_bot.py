import telebot
import re
from telebot import types
from config import TOKEN
from extensions import InputException
from questions import QuestionsAboutAnimals


# 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –±–æ—Ç–∞
bot = telebot.TeleBot(TOKEN)


# 2. –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º (/start –∏ /help).
@bot.message_handler(commands=['start', 'help'])
def start(message):
    photo = open("MZoo-logo since 1864-vert-rus_preview-01.jpg", "rb")
    text = ('üëãüèº –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π! –¢—ã –ø–æ–ø–∞–ª –Ω–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—É, —Å–≤—è–∑–∞–Ω–Ω—É—é —Å –ú–æ—Å–∫–æ–≤—Å–∫–∏–º –∑–æ–æ–ø–∞—Ä–∫–æ–º, \
–Ω–∞ —Ç–µ–º—É "–ö–∞–∫–æ–µ —É –≤–∞—Å —Ç–æ—Ç–µ–º–Ω–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ?". \n\n–ì–æ—Ç–æ–≤—ã –ª–∏ –≤—ã –ø–æ–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö \
–∑–æ–æ–ø–∞—Ä–∫–æ–≤ –ï–≤—Ä–æ–ø—ã, –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –µ–≥–æ –æ–±–∏—Ç–∞—Ç–µ–ª—è–º–∏ –≤ —Ñ–æ—Ä–º–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã –∏ –≤–µ—Å–µ–ª–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤—Ä–µ–º—è? \n\n\
–¢–æ–≥–¥–∞ –Ω–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ ‚Äì "–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç". \n\n‚ÄºÔ∏è –î–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –º–æ–∂–µ—Ç–µ —Ç–∞–∫–∂–µ —Å–≤—è–∑–∞—Ç—å—Å—è \
—Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º –∑–æ–æ–ø–∞—Ä–∫–∞, –Ω–∞–∂–∞–≤ –ø–æ –∫–Ω–æ–ø–∫–µ –Ω–∏–∂–µ.')
    bot.send_message(message.chat.id, text)
    bot.send_photo(message.chat.id, photo=photo)
    button_start(message)


# 3. –í—ã–≤–æ–¥ –∫–Ω–æ–ø–æ–∫ "–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç" –∏ "–°–≤—è–∑–∞—Ç—å—Å—è —Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º –∑–æ–æ–ø–∞—Ä–∫–∞".
@bot.message_handler(commands=['button'])
def button_start(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, row_width=2)
    item1 = types.KeyboardButton("–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç")
    item2 = types.KeyboardButton("–°–≤—è–∑–∞—Ç—å—Å—è —Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º –∑–æ–æ–ø–∞—Ä–∫–∞")
    markup.add(item1)
    markup.add(item2)
    bot.send_message(message.chat.id, '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ, —á—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ, –Ω–∞–∂–∞–≤ –ø–æ –∫–Ω–æ–ø–∫–µ –Ω–∏–∂–µ', reply_markup=markup)


# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–≤–æ–¥–∞ –Ω–∞ –æ—à–∏–±–∫—É.
@bot.message_handler(func=lambda message: message.text == '–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç' or message.text == '–°–≤—è–∑–∞—Ç—å—Å—è —Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º –∑–æ–æ–ø–∞—Ä–∫–∞' or message.text == '–°—ã–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞' or message.text == '–ó–∞–∫–æ–Ω—á–∏—Ç—å –∏–≥—Ä—É' or message.text == '–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –≤ —Å–æ—Ü. —Å–µ—Ç—è—Ö')
def handle_text(message):
    try:
        if message.text.lower() == '–Ω–∞—á–∞—Ç—å —Ç–µ—Å—Ç' or message.text.lower() == '—Å—ã–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞':
            ask_question(message)
        elif message.text.lower() == '—Å–≤—è–∑–∞—Ç—å—Å—è —Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º –∑–æ–æ–ø–∞—Ä–∫–∞':
            contact_zoo_staff(message)
        elif message.text.lower() == '–ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –≤ —Å–æ—Ü. —Å–µ—Ç—è—Ö':
            share_on_social_networks()
        elif message.text.lower() == '–∑–∞–∫–æ–Ω—á–∏—Ç—å –∏–≥—Ä—É':
            end_game(message)

    except InputException as e:
        bot.reply_to(message, f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: \n{e}")


# 5. –§—É–Ω–∫—Ü–∏—è –≤—ã–≤–æ–¥–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∑–æ–æ–ø–∞—Ä–∫–∞.
def contact_zoo_staff(message):
    keyboard = types.InlineKeyboardMarkup()
    url_button = types.InlineKeyboardButton(text="–°–≤—è–∑–∞—Ç—å—Å—è —Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º –∑–æ–æ–ø–∞—Ä–∫–∞", url="https://t.me/alexandetto")
    keyboard.add(url_button)
    bot.send_message(message.chat.id, "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ:", reply_markup=keyboard)


# 6. –§—É–Ω–∫—Ü–∏—è –≤—ã–≤–æ–¥–∞ –∫–Ω–æ–ø–æ–∫ —Å –æ—Ç–≤–µ—Ç–∞–º–∏.
def output_question_and_answers(message, k):
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True, row_width=2)
    buttons = []
    for var in list(QuestionsAboutAnimals.items())[k][1]:
        buttons.append(types.KeyboardButton(text=var))
    keyboard.add(*buttons)

    return keyboard


# 7. –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–æ–ø—Ä–æ—Å–∞.
def ask_question(message: types.Message, k=-2, counts=None):
    if counts is None:
        counts = {'1': 0, '2': 0, '3': 0, '4': 0}
    if k != len(QuestionsAboutAnimals) - 2:
        k += 1
        kb = output_question_and_answers(message, k)
        msg = bot.send_message(message.chat.id, text=list(QuestionsAboutAnimals.items())[k][0], reply_markup=kb)
        bot.register_next_step_handler(msg, process_answer, k, counts)
    else:
        bot.send_message(message.chat.id, text='–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω! ü•≥\n\n–ò–∏–∏–∏, –í–∞—à–µ —Ç–æ—Ç–µ–º–Ω–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ...', reply_markup=types.ReplyKeyboardRemove())
        calculation_results(counts, message)


# 8. –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞.
@bot.message_handler()
def process_answer(message: types.Message, k, counts):
    try:
        if re.search(r'^([1-4]\.\s)', message.text):
            counts[message.text[0]] += 1
            ask_question(message, k, counts)
        else:
            raise InputException("‚Äì –ù–∞–∂–∏–º–∞–π—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ, –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –¥–∞—Ç—å –æ—Ç–≤–µ—Ç!")
    except InputException as e:
        bot.reply_to(message, f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: \n{e}")


# 9. –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –æ—Ç–≤–µ—Ç–æ–≤.
def calculation_results(counts, message):
    max_count = max(counts.values())
    max_categories = [cat for cat, count in counts.items() if count == max_count]

    totem_info = {
        '1': ("–í–æ–ª–∫ ‚Äî —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç —Å–≤–æ–±–æ–¥—É –∏ –∏–Ω—Ç—É–∏—Ü–∏—é. –í–æ–ª–∫–∏ –∏–∑–≤–µ—Å—Ç–Ω—ã —Å–≤–æ–µ–π —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ—Å—Ç—å—é, –∂–∏–≤—É—Ç –∏ –æ—Ö–æ—Ç—è—Ç—Å—è –≤ —Å—Ç–∞—è—Ö, —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ –∏—Ö –≥–ª—É–±–æ–∫–∏—Ö —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–≤—è–∑—è—Ö. –û–Ω–∏ –æ–±–ª–∞–¥–∞—é—Ç –≤—ã–¥–∞—é—â–∏–º–∏—Å—è –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è–º–∏, –ø–æ–º–æ–≥–∞—é—â–∏–º–∏ –∏–º –≤—ã–∂–∏–≤–∞—Ç—å –≤ –¥–∏–∫–æ–π –ø—Ä–∏—Ä–æ–¥–µ. –í–æ–ª–∫ —Ç–∞–∫–∂–µ —è–≤–ª—è–µ—Ç—Å—è —Å–∏–º–≤–æ–ª–æ–º —Å–≤–æ–±–æ–¥—ã –¥—É—Ö–∞, —Å–º–µ–ª–æ—Å—Ç–∏ –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –æ–Ω –Ω–µ –±–æ–∏—Ç—Å—è –∏–¥—Ç–∏ —Å–≤–æ–∏–º –ø—É—Ç–µ–º.", "CAACAgIAAxkBAAEMcGBmh7RGtirsKplZgx9YvyxQRmEyWwAClU4AAos6QUgfEYkYUBjSWTUE"),
        '2': ("–ú–µ–¥–≤–µ–¥—å ‚Äî –æ–ª–∏—Ü–µ—Ç–≤–æ—Ä—è–µ—Ç —Å–∏–ª—É –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å. –ú–µ–¥–≤–µ–¥—å ‚Äî –º–æ—â–Ω–æ–µ –∏ –≤–Ω—É—à–∞—é—â–µ–µ —É–≤–∞–∂–µ–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω–æ–µ, –∫–æ—Ç–æ—Ä–æ–µ —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç –ª–∏–¥–µ—Ä—Å—Ç–≤–æ –∏ —Å–∏–ª—É. –û–Ω —Ç–∞–∫–∂–µ –∞—Å—Å–æ—Ü–∏–∏—Ä—É–µ—Ç—Å—è —Å –∑–∞—â–∏—Ç–æ–π, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é –∏ —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å—é. –ú–µ–¥–≤–µ–¥–∏ —Å–ø–æ—Å–æ–±–Ω—ã –∫ –≥–ª—É–±–æ–∫–æ–º—É —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—é –∏ –º–µ–¥–∏—Ç–∞—Ü–∏–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –≤–æ –≤—Ä–µ–º—è –∑–∏–º–Ω–µ–π —Å–ø—è—á–∫–∏, —á—Ç–æ –æ—Ç—Ä–∞–∂–∞–µ—Ç –∏—Ö —Å–≤—è–∑—å —Å –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∏–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ —Å–æ–∑–Ω–∞–Ω–∏—è –∏ –∏–Ω—Ç—É–∏—Ü–∏–µ–π.", "CAACAgIAAxkBAAEMcERmh7Mad_ihHUzkfXmugJuphwqJXgACvEwAAtQxQEjFAVvyRljyuzUE"),
        '3': ("–õ–æ—à–∞–¥—å ‚Äî —Å–∏–º–≤–æ–ª —Å–≤–æ–±–æ–¥—ã –∏ –º–æ—â–∏. –õ–æ—à–∞–¥–∏ ‚Äî —Å—É—â–µ—Å—Ç–≤–∞, –∏–∑–ª—É—á–∞—é—â–∏–µ —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ—Å—Ç—å –∏ –º–æ—â—å, —Å–ø–æ—Å–æ–±–Ω—ã–µ –±—ã—Å—Ç—Ä–æ –¥–≤–∏–≥–∞—Ç—å—Å—è –∏ –ø—Ä–µ–æ–¥–æ–ª–µ–≤–∞—Ç—å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è. –û–Ω–∏ —Ç–∞–∫–∂–µ –∞—Å—Å–æ—Ü–∏–∏—Ä—É—é—Ç—Å—è —Å–æ —Å–≤–æ–±–æ–¥–æ–π, –ø–æ—Å–∫–æ–ª—å–∫—É –∏—Ö –≥—Ä–∞—Ü–∏–æ–∑–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∏ —Å–∏–ª–∞ –¥—É—Ö–∞ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—Ç –Ω–∞ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –æ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –∏ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Å–≤–æ–∏–º –∂–µ–ª–∞–Ω–∏—è–º.", "CAACAgIAAxkBAAEMcEZmh7MrlBV0UKCxcygMaehX1yanZgACwEUAApKHQUglNOHSSuR1FTUE"),
        '4': ("–°–æ–≤–∞ ‚Äî –º—É–¥—Ä–æ—Å—Ç—å –∏ –∑–∞–≥–∞–¥–æ—á–Ω–æ—Å—Ç—å. –°–æ–≤—ã, —Å –∏—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å—é –≤–∏–¥–µ—Ç—å –≤ —Ç–µ–º–Ω–æ—Ç–µ, —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É—é—Ç –≥–ª—É–±–æ–∫—É—é –∏–Ω—Ç—É–∏—Ü–∏—é –∏ –∑–Ω–∞–Ω–∏–µ —Ç–∞–π–Ω–æ–≥–æ. –≠—Ç–∏ –ø—Ç–∏—Ü—ã —á–∞—Å—Ç–æ –∞—Å—Å–æ—Ü–∏–∏—Ä—É—é—Ç—Å—è —Å –º—É–¥—Ä–æ—Å—Ç—å—é, –ø–æ—Å–∫–æ–ª—å–∫—É –∏—Ö –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤–∏–¥–µ—Ç—å —Ç–æ, —á—Ç–æ —Å–∫—Ä—ã—Ç–æ –æ—Ç –¥—Ä—É–≥–∏—Ö, –¥–µ–ª–∞–µ—Ç –∏—Ö —Å–∏–º–≤–æ–ª–æ–º –∑–Ω–∞–Ω–∏—è –∏ –∑–∞–≥–∞–¥–æ—á–Ω–æ—Å—Ç–∏.", "CAACAgIAAxkBAAEMcEhmh7M9ad02TGcYTYlaFjJfX1JHywACeVAAAskcQUi2TvgHTAOeAjUE"),
        ('1', '2'): ("–û–ª–µ–Ω—å ‚Äî –∏–∑—è—â–µ—Å—Ç–≤–æ –∏ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ. –û–ª–µ–Ω–∏ ‚Äî —ç–ª–µ–≥–∞–Ω—Ç–Ω—ã–µ –∂–∏–≤–æ—Ç–Ω—ã–µ, –¥–≤–∏–∂–µ–Ω–∏—è –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞–ø–æ–ª–Ω–µ–Ω—ã –≥—Ä–∞—Ü–∏–µ–π –∏ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ–º. –û–Ω–∏ –Ω–∞–ø–æ–º–∏–Ω–∞—é—Ç –æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –±—ã—Ç—å –ª–µ–≥–∫–∏–º –Ω–∞ –ø–æ–¥—ä–µ–º –∏ —Å–ø–æ—Å–æ–±–Ω—ã–º –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏ —ç—Ç–æ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –∏ –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–æ.", "CAACAgIAAxkBAAEMcEpmh7NLj9rDva4HKN81qEO-zNjyLAACxVUAAl5SOUgeRzoC2oF01TUE"),
        ('1', '3'): ("–î–µ–ª—å—Ñ–∏–Ω ‚Äî –∏–≥—Ä–∏–≤–æ—Å—Ç—å –∏ –≥–∞—Ä–º–æ–Ω–∏—è. –î–µ–ª—å—Ñ–∏–Ω—ã –∏–∑–≤–µ—Å—Ç–Ω—ã —Å–≤–æ–µ–π –¥—Ä—É–∂–µ–ª—é–±–Ω–æ—Å—Ç—å—é, –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º –∏ –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ–º. –û–Ω–∏ –Ω–∞–ø–æ–º–∏–Ω–∞—é—Ç –æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –ª–µ–≥–∫–æ—Å—Ç—å –±—ã—Ç–∏—è, –Ω–∞—Å–ª–∞–∂–¥–∞—Ç—å—Å—è –æ–±—â–µ–Ω–∏–µ–º –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å —Ä–∞–¥–æ—Å—Ç—å –≤ –ø—Ä–æ—Å—Ç—ã—Ö –≤–µ—â–∞—Ö, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—è –ø—Ä–∏ —ç—Ç–æ–º –≥–∞—Ä–º–æ–Ω–∏—é —Å –æ–∫—Ä—É–∂–∞—é—â–∏–º –º–∏—Ä–æ–º.", "CAACAgIAAxkBAAEMcExmh7NaPnM6QCkbKDZtzibx2YPZ2gACFEsAAm9eOEgAAaGQN4mmMUQ1BA"),
        ('1', '4'): ("–ü—É–º–∞ ‚Äî —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å. –ü—É–º—ã ‚Äî —Å–∏–ª—å–Ω—ã–µ –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ö–∏—â–Ω–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É—é—Ç—Å—è —Å–≤–æ–µ–π –∏–Ω—Ç—É–∏—Ü–∏–µ–π –∏ –∏–º–µ—é—Ç —Å–∏–ª—å–Ω—ã–π –¥—É—Ö. –û–Ω–∏ –æ–ª–∏—Ü–µ—Ç–≤–æ—Ä—è—é—Ç —Å–º–µ–ª–æ—Å—Ç—å –∏–¥—Ç–∏ —Å–≤–æ–∏–º", "CAACAgIAAxkBAAEMcE5mh7No_l1FLehOM6VGtUwOkTzhKAACj0kAAoWqQEio0bZ8S_LIsDUE"),
        ('2', '3'): ("–û—Ä—ë–ª ‚Äî —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç –æ—Å—Ç—Ä–æ—Ç—É –∑—Ä–µ–Ω–∏—è –∏ —Å–≤–æ–±–æ–¥—É –¥—É—Ö–∞. –û—Ä–ª—ã –æ–±–ª–∞–¥–∞—é—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å—é –≤–∏–¥–µ—Ç—å —Ü–µ–ª–∏ –Ω–∞ –±–æ–ª—å—à–æ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏, –Ω–µ —Ç–µ—Ä—è—è –ø—Ä–∏ —ç—Ç–æ–º —Å–≤—è–∑–∏ —Å –∑–µ–º–ª—ë–π. –≠—Ç–æ –∂–∏–≤–æ—Ç–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ—á–µ—Ç–∞—é—Ç –≤ —Å–µ–±–µ –∫–∞–∫ –º–æ—â—å, —Ç–∞–∫ –∏ –∫—Ä–∞—Å–æ—Ç—É, —Å–ø–æ—Å–æ–±–Ω—ã–µ –ø—Ä–∏—Å–ø–æ—Å–∞–±–ª–∏–≤–∞—Ç—å—Å—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –∏ –ø—Ä–µ–æ–¥–æ–ª–µ–≤–∞—Ç—å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è.", "CAACAgIAAxkBAAEMcFBmh7N18Blq1KTEcYn-Wod0YfnNRwACvUsAAlmBOUjg4BfEqnoVWzUE"),
        ('2', '4'): ("–õ–∏—Å–∞ ‚Äî –º–µ—Ç–∞—Ñ–æ—Ä–∞ —Ö–∏—Ç—Ä–æ—Å—Ç–∏ –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏. –õ–∏—Å—ã –∏–∑–≤–µ—Å—Ç–Ω—ã —Å–≤–æ–µ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å—é –≤—ã–∂–∏–≤–∞—Ç—å –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö, –∏—Å–ø–æ–ª—å–∑—É—è –æ—Å—Ç—Ä—ã–π —É–º –∏ –∏–∑–æ–±—Ä–µ—Ç–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –û–Ω–∏ —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É—é—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –Ω–∞—Ö–æ–¥–∏—Ç—å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –∏ –ª–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫ –Ω–æ–≤—ã–º –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞–º, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏ —ç—Ç–æ–º —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∏ —Å–∏–ª—É.", "CAACAgIAAxkBAAEMcFJmh7OCC4L-ZTUDiDpoiMgaK_1H8gACTUkAAqTRQEjbOnSrbi84ojUE"),
        ('3', '4'): ("–ß–µ—Ä–µ–ø–∞—Ö–∞ ‚Äî –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –º—É–¥—Ä–æ—Å—Ç—å, –¥–æ–ª–≥–æ–ª–µ—Ç–∏–µ –∏ —Å—Ç–æ–π–∫–æ—Å—Ç—å. –ß–µ—Ä–µ–ø–∞—Ö–∏ –∂–∏–≤—É—Ç –¥–æ–ª–≥–æ, –¥–≤–∏–≥–∞—é—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–æ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç–∏–≥–∞—é—Ç —Å–≤–æ–µ–π —Ü–µ–ª–∏ –±–ª–∞–≥–æ–¥–∞—Ä—è –Ω–µ–ø–æ–∫–æ–ª–µ–±–∏–º–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Å–µ–±–µ –∏ —Å–≤–æ–∏—Ö —Å–∏–ª–∞—Ö. –û–Ω–∏ –Ω–∞–ø–æ–º–∏–Ω–∞—é—Ç –æ –≤–∞–∂–Ω–æ—Å—Ç–∏ —Ç–µ—Ä–ø–µ–Ω–∏—è, —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –ª–∏—Ü–æ–º —Ç—Ä—É–¥–Ω–æ—Å—Ç–µ–π –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –≤ –ª—é–±–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏.", "CAACAgIAAxkBAAEMcFRmh7OTUHm3i__iduQKG-ohSOkTbwAC9FEAAtXPOEhVDqgD_bwXlTUE"),
        ('1', '2', '3'): ("–¢–∏–≥—Ä ‚Äî —Ç–æ—Ç–µ–º–Ω–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ–ª–∏—Ü–µ—Ç–≤–æ—Ä—è–µ—Ç —Å–æ–∑–∏–¥–∞–Ω–∏–µ –∏ —Ä–∞–∑—Ä—É—à–µ–Ω–∏–µ. –≠—Ç–æ –∂–∏–≤–æ—Ç–Ω–æ–µ —Å –ø–æ–∏—Å—Ç–∏–Ω–µ –∫–æ—Ä–æ–ª–µ–≤—Å–∫–∏–º –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–æ–º, —Å–∏–ª—å–Ω–æ–µ, –≤–ª–∞—Å—Ç–Ω–æ–µ, –∂–µ—Å—Ç–æ–∫–æ–µ, –º—É–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏ —è—Ä–æ—Å—Ç–Ω–æ–µ. –í—Å–µ —ç—Ç–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É—é—Ç –µ–≥–æ –∫–∞–∫ –∑–∞—â–∏—Ç–Ω–∏–∫–∞. –ß–µ–ª–æ–≤–µ–∫, –Ω–∞—Ö–æ–¥—è—â–∏–π—Å—è –ø–æ–¥ –ø–æ–∫—Ä–æ–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ–º —Ç–æ—Ç–µ–º–∞ —Ç–∏–≥—Ä–∞, —è–≤–ª—è–µ—Ç—Å—è –≤–ª–∞—Å—Ç–∏—Ç–µ–ª–µ–º —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –∂–∏–∑–Ω–∏. –≠—Ç–æ—Ç —Ç–æ—Ç–µ–º —É—á–∏—Ç, —á—Ç–æ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –Ω–∞—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø–∞—Å—Ç–∏—Å—å —Ç–µ—Ä–ø–µ–Ω–∏–µ–º –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã.", "CAACAgIAAxkBAAEMcFZmh7OrCoLMqp1eGxiqITRtqbBSUAACeEMAAhxbQUhXLUkIxF-URjUE"),
        ('1', '2', '4'): ("–ï–Ω–æ—Ç ‚Äî —Ç–æ—Ç–µ–º–Ω–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ —Å –æ–±–º–∞–Ω—á–∏–≤–æ –º–∏–ª–æ–π –≤–Ω–µ—à–Ω–æ—Å—Ç—å—é –∏ —É–¥–∏–≤–∏—Ç–µ–ª—å–Ω—ã–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º. –ï–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞–Ω–æ—Å–∏–ª–∏ –Ω–∞ —Ç–µ–ª–æ —Å –¥–∞–≤–Ω–∏—Ö –≤—Ä–µ–º–µ–Ω, —á—Ç–æ–±—ã –ø–µ—Ä–µ–Ω—è—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ —á–µ—Ä—Ç—ã –∑–≤–µ—Ä–∏–Ω–æ–π –Ω–∞—Ç—É—Ä—ã ‚Äî –ª–æ–≤–∫–æ—Å—Ç—å –∏ —É–º–µ–Ω–∏–µ –º–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è. –í —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –º–∏—Ä–µ —Ç–∞—Ç—É —Å –µ–Ω–æ—Ç–æ–º –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç –Ω–µ—É–ª–æ–≤–∏–º—É—é —Å–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å, –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ—â—É—â–µ–Ω–∏–π.", "CAACAgIAAxkBAAEMcFhmh7O7_YRR6wWEaDXX9U-IXk5nwwACWUUAAqmPQUhRmwp5Mg70jzUE"),
        ('1', '3', '4'): ("–õ–µ–≤ ‚Äî —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏–ª—É, –æ—Ç–≤–∞–≥—É, –º–æ–≥—É—â–µ—Å—Ç–≤–æ, –∫–æ—Ä–æ–ª–µ–≤—Å–∫—É—é –≤–ª–∞—Å—Ç—å, –∑–∞—â–∏—Ç—É, –≥–æ—Ä–¥–æ—Å—Ç—å, –≤–ª–∞—Å—Ç—å, –≤–µ–ª–∏—á–∏–µ –∏ –º—É–¥—Ä–æ—Å—Ç—å. –ò –ø–æ—Å–∫–æ–ª—å–∫—É –ª—å–≤–∏—Ü—ã —è–≤–ª—è—é—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –æ—Ö–æ—Ç–Ω–∏–∫–∞–º–∏ –ø—Ä–∞–π–¥–∞, –ª—å–≤—ã —Ç–∞–∫–∂–µ —è–≤–ª—è—é—Ç—Å—è —Å–∏–º–≤–æ–ª–∞–º–∏ –∂–µ–Ω—Å–∫–æ–π —Å–∏–ª—ã, —Å–≤–∏—Ä–µ–ø–æ—Å—Ç–∏ –∏ —Å–µ–º—å–∏. –≠—Ç–∏ —Å—É—â–µ—Å—Ç–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –±–µ—Å—Å—Ç—Ä–∞—à–Ω—ã –∏ —É–≤–µ—Ä–µ–Ω—ã –≤ —Å–µ–±–µ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∏—Ö —Å–∏–º–≤–æ–ª–∞–º–∏ –∫–æ—Ä–æ–ª–µ–≤—Å–∫–æ–π –≤–ª–∞—Å—Ç–∏ –∏ –æ—Ç–≤–∞–≥–∏. –õ—å–≤—ã-—Å–∞–º—Ü—ã –∏ —Å–∞–º–∫–∏ —Ç–∞–∫–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ, –ø–æ–¥–Ω–∏–º–∞—è —Å–≤–æ—é –≥–æ—Ä–¥–æ—Å—Ç—å, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—è —Å–∏–ª—É, —Å–µ–º—å—é –∏ –∑–∞—â–∏—Ç—É.", "CAACAgIAAxkBAAEMcFpmh7PK4bEb2aFhCpGSlhalk_uiSQACrk0AAlJdQEhOB7te0OCrljUE"),
        ('2', '3', '4'): ("–ë–µ–ª–∫–∞ ‚Äî –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å. –ë–µ–ª–∫–∏ –≤—Å–µ–≥–¥–∞ –ø—Ä–µ–±—ã–≤–∞—é—Ç –≤ –¥–≤–∏–∂–µ–Ω–∏–∏ –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∫—É–¥–∞-—Ç–æ —Ç–æ—Ä–æ–ø—è—Ç—Å—è, —Å–æ–≤–µ—Ä—à–∞—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —Å—É–µ—Ç–ª–∏–≤—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è. –ë–æ–ª—å—à—É—é —á–∞—Å—Ç—å –≤—Ä–µ–º–µ–Ω–∏ –æ–Ω–∏ –ø—Ä–æ–≤–æ–¥—è—Ç –≤ –ø–æ–∏—Å–∫–∞—Ö –∫–æ—Ä–º–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –µ–≥–æ –∑–∞–ø–∞—Å–æ–≤ –Ω–∞ –∑–∏–º—É, –ø–æ—Å–∫–æ–ª—å–∫—É –≤ —Å–ø—è—á–∫—É –æ–Ω–∏ –Ω–µ –≤–ø–∞–¥–∞—é—Ç. –ì–æ—Ç–æ–≤—è—Å—å –∫ –∑–∏–º–µ, –æ–Ω–∏ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ –µ–¥—è—Ç –∏ –Ω–∞—Ä–∞—â–∏–≤–∞—é—Ç –≤–µ—Å, –∞ —Ç–∞–∫–∂–µ –æ—Ç—Ä–∞—â–∏–≤–∞—é—Ç –≥—É—Å—Ç–æ–π –º–µ—Ö. –ë–µ–ª–∫–∏ —è–≤–ª—è—é—Ç—Å—è —Å–∏–º–≤–æ–ª–∞–º–∏ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.", "CAACAgIAAxkBAAEMcFxmh7PcXzc9cNSOHASuMqXyeu_p7QACBVMAAvGjQEhxWtZurIgDmTUE"),
    }

    if len(max_categories) == 1:
        bot.send_message(message.chat.id, totem_info[str(max_categories[0])])
        bot.send_sticker(message.chat.id, list(totem_info.values())[int(max_categories[0]) - 1][1])
        final_choice(message)
    else:
        bot.send_message(message.chat.id, totem_info[tuple(sorted(max_categories))])
        bot.send_sticker(message.chat.id, totem_info[tuple(sorted(max_categories))][1])
        final_choice(message)


# 10. –§—É–Ω–∫—Ü–∏—è, –¥–ª—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å—ã–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞.
def final_choice(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, row_width=2)

    button1 = types.KeyboardButton("–°–≤—è–∑–∞—Ç—å—Å—è —Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º –∑–æ–æ–ø–∞—Ä–∫–∞")
    button2 = types.KeyboardButton("–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –≤ —Å–æ—Ü. —Å–µ—Ç—è—Ö")
    button3 = types.KeyboardButton("–°—ã–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞")
    button4 = types.KeyboardButton("–ó–∞–∫–æ–Ω—á–∏—Ç—å –∏–≥—Ä—É")

    markup.add(button1)
    markup.add(button2)
    markup.add(button3)
    markup.add(button4)

    bot.send_message(message.chat.id, '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ, —á—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ, –Ω–∞–∂–∞–≤ –ø–æ –∫–Ω–æ–ø–∫–µ –Ω–∏–∂–µ', reply_markup=markup)


# 11. –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –≤ —Å–æ—Ü. —Å–µ—Ç—è—Ö.
def share_on_social_networks():
    pass


# 12. –§—É–Ω–∫—Ü–∏—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã.
def end_game(message):
    bot.send_message(message.chat.id, "–õ–∞–¥–Ω–æ, –∑–¥–æ—Ä–æ–≤–æ —Å—ã–≥—Ä–∞–ª–∏!\n\n–£–¥–∞—á–∏!")
    bot.stop_bot()


# 13. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞.
if __name__ == '__main__':
    bot.infinity_polling()
